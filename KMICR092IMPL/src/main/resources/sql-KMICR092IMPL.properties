#-------->>
# Query para obtener listado de logs relacionados al pago
select.traedatos.log=db1; \
SELECT  G_CONTRACT_ID, GF_MOV_DATE, GF_SEQUENCE_ID, GF_OPERATION_PAGE_ID, \
		GF_ACCT_MOV_ID, G_MICROCREDIT_MOVEMENT_TYPE, GF_MOVEMENT_AMOUNT, \
		G_CURRENCY_ID, G_ACTIVE_MOVEMENT_IND_TYPE, GF_GL_ACCOUNT_DATE, \
		GF_INSTALLMENT_PERIOD_DATE, GF_GL_ACCOUNTING_STRING_ID, G_LOCAL_CONTRACT_TYPE, \
		GF_MOV_ASSO_ACCOUNT_ID, GF_TRACKING_TRANSACTION_DESC, GF_ACCOUNTING_POSITION_ID, \
		GF_NEW_CUST_REGIONAL_CENTRE_ID, GF_APP_CHANNEL_ID, GF_CUSTOMER_PROPOSAL_BRANCH_ID, \
		GF_CREDIT_REQUEST_ORIGIN_RC_ID, GF_USER_AUDIT_ID, GF_AUDIT_DATE \
FROM    T_KMIC_MCRCR_LOG_MOVEMENT \
WHERE   G_MICROCREDIT_MOVEMENT_TYPE NOT IN('PGAUTCON') \
AND     GF_ACCT_MOV_ID = (  SELECT  GF_ACCT_MOV_ID \
                            FROM    T_KMIC_MCRCR_LOG_MOVEMENT \
                            WHERE   G_CONTRACT_ID = :contractId \
                            AND     GF_OPERATION_PAGE_ID = :operationPageId \
                            AND     GF_INSTALLMENT_PERIOD_DATE = :date \
                            GROUP BY GF_ACCT_MOV_ID);
 
#Queries para actualziar montos y dar reverso
#update T_KMIC_MICROCREDIT_CONTRACT
update.microcredit.contract=db1; \
UPDATE KMIC.T_KMIC_MICROCREDIT_CONTRACT SET \
GF_AVAILABLE_AMOUNT = :availableAmount, \
GF_DRAWN_AMOUNT = :drawnAmount, \
G_MCRCR_CONTRACT_STATUS_TYPE = :contractStatusType \
WHERE G_CONTRACT_ID = :contractId;
 
#update T_KMIC_MCRCR_CONT_DISPOSITION
update.mcrcr.disposition=db1; \
UPDATE KMIC.T_KMIC_MCRCR_CONT_DISPOSITION SET \
GF_CR_RECOVERED_TOTAL_AMOUNT = :recoveredTotalAmount, \
GF_REPAYMENT_OUTSTD_AMOUNT = :repaymentOutstdAmount\
WHERE G_CONTRACT_ID = :contractId \
AND GF_OPERATION_PAGE_ID = :operationPageId; \
 
#update T_KMIC_MCRCR_DSPN_AMORT
update.mcrcr.amortization=db1; \
UPDATE KMIC.T_KMIC_MCRCR_DSPN_AMORT SET \
GF_DRWDN_AMORT_TRADE_AMOUNT = :drwdnAmortTradeAmount, \
GF_AMORT_CAPITAL_AMOUNT = :amortCapitalAmount, \
G_MCRCR_AMORT_STATUS_TYPE = :mcrcrAmortStatusType \
WHERE G_CONTRACT_ID = :contractId \
AND GF_OPERATION_PAGE_ID = :operationPageId \
AND GF_ITEM_SETTLEMENT_DATE=:itemSettlementDate; \
 
#update T_KMIC_AMORTIZATION_CONDITION
update.amortization.condition=db1;\
UPDATE KMIC.T_KMIC_AMORTIZATION_CONDITION SET \
GF_INSTLMNT_FEE_RCOVR_AMOUNT = :instlmntFeeRcovrAmount, \
GF_RECOVERED_TAX_AMOUNT = :recoveredTaxAmount, \
G_MCRCR_AMORT_STATUS_TYPE = :mcrcrAmortStatusType \
WHERE G_CONTRACT_ID = :contractId \
AND GF_OPERATION_PAGE_ID = :operationPageId \
AND GF_ITEM_SETTLEMENT_DATE=:itemSettlementDate; \